# ワークステーションの設定
宇宙物理学研究室では、サーバルーム（307号室）にあるワークステーションにssh接続をすることで研究を進めることがあります。
ここでは、ワークステーションへの接続方法を説明する。
以下では、Ubuntuを想定しています。
CentOSやMacは大体同じようにできると思います。
Windowsについては、未検証。

## Step 1. 自分のpcでの操作
自分のpcでターミナル（端末）を開きsshがインストールされているかを確認
```
$which ssh
```
と入力し、
```
/usr/bin/ssh
```
と出力されればOK。
もし何も表示されない場合はインストールをします。
インストールするには、
```
$sudo apt-get install ssh
```
と入力する。
sshがインストールされているのを確認できたら、sshの秘密鍵、公開鍵を作る。
以下、ssh鍵作成手順
(i) home(~/)ディレクトリに.sshディレクトリを作る
```
$mkdir .ssh
$cd .ssh
```
(ii) 鍵を作る
```
$ssh-keygen -t rsa
```
ファイル名を決めるように言われるので、事情等がなければそのまま何も入力せずにエンターを押す。
その後、パスフレーズを入力しろと言われるので任意のパスフレーズを入力
(iii)　鍵ができたかを確認
```
$ls
```
id_rsa(秘密鍵)とid_rsa.pub（公開鍵）の二つがあれば完了
(iv) .sshの中にconfigファイルを作る
configファイル内に２箇所"User ???"という行があるので???に自分のユーザー名に書き換える
(v)公開鍵のコピー
USBメモリか何かに公開鍵(id_rsa.pub)をコピーする

以上で、自分のpcでの作業は終了
次にサーバルームで作業する

## Step 2. gemini（ゲートウェイサーバ)でのアカウント作成
まず、gemini（ゲートウェイサーバ)にアカウントを作る。
geminiには、rootでログインする。
なおgeminiは、pcへの負荷を減らすためGUIでの操作ができなくなっている
以下アカウント作成手順・???にはStep 1と同じ自分のユーザ名
(i) ユーザ作成
geminiにユーザを追加し、/homeディレクトリに自分のユーザ名のディレクトリを作る

またログインシェルをnologinに変更して外部から操作できないように設定する

その後/homeディレクトリにできた自分のユーザ名のディレクトリに移動する
```
$useradd -d /home/??? -g 501 -m ???
$usermod -s /usr/sbin/nologin アカウント名
$cd /home/???
```
(ii) 公開鍵のコピー
自分のディレクトリで.sshディレクトリを作り、そこに公開鍵をコピーする
$USBPATHは、USBメモリのパス
調べ方は後述
```
$mkdir .ssh
$cp $USBPATH/id_rsa.pub .ssh
```
(iii) 公開鍵の名前変更
.sshに移動しid_rsa.pubの名前をauthorized_keysに変更
```
$cd .ssh
$cat id_rsa.pub >> authorized_keys
```
(iv) authorized_keysの権限・所有者の変更
```
$chmod 600 authorized_keys
$chown ???:aplab authorized_keys
```
(v) .sshの権限、所有者の変更
```
$cd ..
$chmod 700 .ssh
$chown ???:aplab .ssh
```

geminiでの作業は以上で終了・ログアウトする。
コマンドは
```
$exit
```
このときシャットダウンはしない！！

## Step 3. 各ワークステーションでの設定
各ワークステーションでgeminiと同様の設定を行う
ここで、自分のユーザディレクトリの場所がgeminiと異なる
geminiは/home/、他は/home/aplab
コマンドは以下
```
$useradd -d /home/aplab/??? -g 501 -m ???
```
※しかしこれらは、2020年くらい以前からあったもの向け
最近大栗先生・大里先生が設置したものは違うと思うので個別に確認
ただし、geminiについては一緒

## Step 4. 接続
自分のpcに戻ってターミナルでssh接続する。
接続方法は以下
```
$ssh ???
```
???には、ワークステーションの名前
接続に成功すれば終了
